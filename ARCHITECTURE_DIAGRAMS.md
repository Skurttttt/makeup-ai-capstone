# ğŸ“Š Admin System Architecture & Data Flow Diagrams

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FACETUNE BEAUTY APP SYSTEM                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   ADMIN USERS    â”‚                  â”‚   REGULAR USERS      â”‚   â”‚
â”‚  â”‚   (Web Browser)  â”‚                  â”‚  (Mobile/Browser)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                       â”‚                â”‚
â”‚           â”‚ Login                                 â”‚ Login          â”‚
â”‚           â–¼                                       â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ AdminScreenNew       â”‚            â”‚  HomeScreen          â”‚    â”‚
â”‚  â”‚ - Accounts Tab       â”‚            â”‚  - Premium Tab       â”‚    â”‚
â”‚  â”‚ - Subscriptions Tab  â”‚            â”‚  - Settings Tab      â”‚    â”‚
â”‚  â”‚ - Audit Logs Tab     â”‚            â”‚  - Other Tabs        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                     â”‚                 â”‚
â”‚           â”‚ Edit Dialogs                        â”‚                 â”‚
â”‚           â”‚ â€¢ Account (name, role)              â”‚                 â”‚
â”‚           â”‚ â€¢ Subscription (plan, status)       â”‚ Real-time       â”‚
â”‚           â”‚                                     â”‚ Listener:       â”‚
â”‚           â–¼                                     â”‚ subscribeToUser â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                 â”‚
â”‚  â”‚     SUPABASE BACKEND                     â”‚â—„â”€â”˜                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
â”‚  â”‚ PostgREST API:                           â”‚                    â”‚
â”‚  â”‚ â€¢ updateUserProfile()                    â”‚                    â”‚
â”‚  â”‚ â€¢ updateSubscription()                   â”‚                    â”‚
â”‚  â”‚ â€¢ logAdminAction()                       â”‚                    â”‚
â”‚  â”‚ â€¢ getAuditLogs()                         â”‚                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
â”‚  â”‚ Real-time (PostgreSQL LISTEN):           â”‚                    â”‚
â”‚  â”‚ â€¢ accounts channel                       â”‚                    â”‚
â”‚  â”‚ â€¢ subscriptions channel                  â”‚                    â”‚
â”‚  â”‚ â€¢ audit_logs channel                     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚           â”‚                  â”‚                                   â”‚
â”‚           â–¼                  â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚     PostgreSQL Database               â”‚                      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                      â”‚
â”‚  â”‚  â”‚ accounts                       â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ id, email, full_name         â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ role (admin/user/client)     â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ avatar_url, bio              â”‚   â”‚                      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                      â”‚
â”‚  â”‚  â”‚ subscriptions                  â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ id, account_id (FK)          â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ plan, status                 â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ current_period_end           â”‚   â”‚                      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                      â”‚
â”‚  â”‚  â”‚ audit_logs                     â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ id, actor_id, action         â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ target, metadata             â”‚   â”‚                      â”‚
â”‚  â”‚  â”‚ â€¢ created_at                   â”‚   â”‚                      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Admin Edits Account

```
Admin Interface                    Backend                        Database
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin Dashboard  â”‚             â”‚  Supabase    â”‚             â”‚PostgreSQLâ”‚
â”‚                  â”‚             â”‚              â”‚             â”‚          â”‚
â”‚ Accounts Tab     â”‚             â”‚              â”‚             â”‚          â”‚
â”‚ â”œâ”€ John Doe      â”‚             â”‚              â”‚             â”‚ accounts â”‚
â”‚ â”‚ â”œâ”€ Email       â”‚             â”‚              â”‚             â”‚ â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â”œâ”€ Role: user  â”‚             â”‚              â”‚             â”‚ â”‚John  â”‚  â”‚
â”‚ â”‚ â””â”€ Edit [btn]  â”‚             â”‚              â”‚             â”‚ â”‚role  â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚              â”‚             â”‚ â”‚user  â”‚  â”‚
          â”‚                       â”‚              â”‚             â”‚ â””â”€â”€â”€â”€â”€â”˜  â”‚
          â”‚ Click Edit            â”‚              â”‚             â”‚          â”‚
          â–¼                       â”‚              â”‚             â”‚          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚              â”‚             â”‚          â”‚
â”‚ Edit Dialog      â”‚             â”‚              â”‚             â”‚          â”‚
â”‚                  â”‚             â”‚              â”‚             â”‚          â”‚
â”‚ Name: John Doe   â”‚             â”‚              â”‚             â”‚          â”‚
â”‚ Role: [Dropdown] â”‚             â”‚              â”‚             â”‚          â”‚
â”‚  â”œâ”€ user âœ“       â”‚             â”‚              â”‚             â”‚          â”‚
â”‚  â””â”€ admin        â”‚             â”‚              â”‚             â”‚          â”‚
â”‚                  â”‚             â”‚              â”‚             â”‚          â”‚
â”‚ [Save] [Cancel]  â”‚             â”‚              â”‚             â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚              â”‚             â”‚          â”‚
          â”‚                       â”‚              â”‚             â”‚          â”‚
          â”‚ Select "admin"        â”‚              â”‚             â”‚          â”‚
          â”‚ Click Save            â”‚              â”‚             â”‚          â”‚
          â–¼                       â”‚              â”‚             â”‚          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚              â”‚             â”‚          â”‚
â”‚ Sending: {        â”‚             â”‚              â”‚             â”‚          â”‚
â”‚  id: john-123     â”‚             â”‚              â”‚             â”‚          â”‚
â”‚  role: "admin"    â”‚             â”‚              â”‚             â”‚          â”‚
â”‚ }                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º              â”‚             â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚              â”‚             â”‚          â”‚
                                 â”‚ updateUser  â”‚             â”‚          â”‚
                                 â”‚ Profile()   â”‚             â”‚          â”‚
                                 â–¼              â”‚             â”‚          â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚             â”‚          â”‚
                          â”‚ Validate     â”‚     â”‚             â”‚          â”‚
                          â”‚ - JWT token  â”‚     â”‚             â”‚          â”‚
                          â”‚ - Is admin?  â”‚     â”‚             â”‚          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚             â”‚          â”‚
                                 â”‚             â”‚             â”‚          â”‚
                                 â”‚ OK         â”‚             â”‚          â”‚
                                 â–¼             â”‚             â”‚          â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚             â”‚          â”‚
                          â”‚ UPDATE       â”‚     â”‚             â”‚          â”‚
                          â”‚ accounts     â”‚â”€â”€â”€â”€â”€â–º             â”‚          â”‚
                          â”‚ SET role=    â”‚     â”‚             â”‚          â”‚
                          â”‚ 'admin'      â”‚     â”‚             â–¼          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    UPDATE accounts     â”‚
                                 â”‚             â”‚    SET role='admin'    â”‚
                                 â”‚             â”‚    WHERE id='john-123' â”‚
                                 â”‚             â”‚                        â”‚
                                 â”‚             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
                                 â”‚             â”‚   â”‚ Success  â”‚        â”‚
                                 â”‚             â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
                                 â”‚             â”‚        â”‚              â”‚
                                 â”‚             â”‚ PostgreSQL            â”‚
                                 â”‚             â”‚ NOTIFY accounts       â”‚
                                 â”‚             â”‚                       â”‚
                                 â–¼             â–¼                       â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [TRIGGER]                   â”‚
                          â”‚ Log Action   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                          â”‚ INSERT INTO  â”‚                         â”‚   â”‚
                          â”‚ audit_logs   â”‚                         â”‚   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â–¼   â”‚
                                 â”‚                          INSERT INTO  â”‚
                                 â”‚                          audit_logs    â”‚
                                 â”‚                                        â”‚
                                 â–¼                                        â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
                          â”‚ Return Success                              â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
                                 â”‚                                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
          â–¼                                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚ Admin UI Updates â”‚                                                  â”‚
â”‚ â€¢ Close dialog   â”‚                                                  â”‚
â”‚ â€¢ Refresh table  â”‚                                                  â”‚
â”‚ â€¢ Show success   â”‚                                                  â”‚
â”‚   message        â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
```

## Real-time Sync: User Sees Changes

```
Timeline:
T=0:00   Admin makes change â”€â”€ Database updated â”€â”€ PostgreSQL notifies
T=0:05   User app receives real-time notification
T=0:10   User UI refreshes automatically
T=0:15   User sees the change

VISUAL:

â”Œâ”€ ADMIN SIDE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€ USER SIDE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  â”‚    â”‚                                    â”‚
â”‚ AdminScreenNew                   â”‚    â”‚ User Subscription Page             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Accounts Tab                 â”‚ â”‚    â”‚ â”‚ My Subscription              â”‚  â”‚
â”‚ â”‚                              â”‚ â”‚    â”‚ â”‚                              â”‚  â”‚
â”‚ â”‚ John Doe                     â”‚ â”‚    â”‚ â”‚ Plan: Trial                  â”‚  â”‚
â”‚ â”‚ john@example.com             â”‚ â”‚    â”‚ â”‚ Status: ACTIVE               â”‚  â”‚
â”‚ â”‚ Role: user [Edit]            â”‚ â”‚    â”‚ â”‚ Renews: Feb 10, 2026         â”‚  â”‚
â”‚ â”‚                              â”‚ â”‚    â”‚ â”‚                              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚    â”‚                                    â”‚
â”‚ T=0:00                           â”‚    â”‚                                    â”‚
â”‚ Admin clicks Edit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º T=0:00 (no change yet)           â”‚
â”‚                                  â”‚    â”‚                                    â”‚
â”‚ T=0:02                           â”‚    â”‚                                    â”‚
â”‚ Dialog appears                   â”‚    â”‚ User Subscription Page             â”‚
â”‚ Changes role: user â†’ admin       â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ Clicks Save                      â”‚    â”‚ â”‚ My Subscription              â”‚  â”‚
â”‚                                  â”‚    â”‚ â”‚ Plan: Trial                  â”‚  â”‚
â”‚ T=0:05                           â”‚    â”‚ â”‚ Status: ACTIVE               â”‚  â”‚
â”‚ Database updates â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚PostgreSQL NOTIFY            â”‚  â”‚    â”‚ T=0:05 (Real-time update!)       â”‚
â”‚ â”‚ LISTEN 'accounts'           â”‚  â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ accounts updated            â”‚  â”‚    â”‚ â”‚ My Subscription              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ â”‚ Real-time listener detects   â”‚  â”‚
â”‚                                  â”‚    â”‚ â”‚ subscription change          â”‚  â”‚
â”‚ Supabase Realtime              â”‚    â”‚ â”‚ setState() called             â”‚  â”‚
â”‚ broadcasts to all clients      â”‚    â”‚ â”‚ UI refreshes                  â”‚  â”‚
â”‚                                  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ T=0:08                           â”‚    â”‚ T=0:08 (UI Updated!)              â”‚
â”‚ Dialog closes                    â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ Table refreshes                  â”‚    â”‚ â”‚ My Subscription              â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”‚ Plan: Premium    â—„â”€ CHANGED  â”‚  â”‚
â”‚ â”‚ Accounts Tab                 â”‚ â”‚    â”‚ â”‚ Status: ACTIVE               â”‚  â”‚
â”‚ â”‚                              â”‚ â”‚    â”‚ â”‚ Renews: Mar 10, 2026 â—„â”€ NEW â”‚  â”‚
â”‚ â”‚ John Doe                     â”‚ â”‚    â”‚ â”‚                              â”‚  â”‚
â”‚ â”‚ john@example.com             â”‚ â”‚    â”‚ â”‚ [Manage Subscription]        â”‚  â”‚
â”‚ â”‚ Role: admin â—„â”€ UPDATED       â”‚ â”‚    â”‚ â”‚                              â”‚  â”‚
â”‚ â”‚                              â”‚ â”‚    â”‚ â”‚ âœ¨ Updated successfully!     â”‚  â”‚
â”‚ â”‚ Edit | Delete                â”‚ â”‚    â”‚ â”‚                              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚    â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Actual Latency: 50-150ms
User Perception: Instant
```

## Audit Trail Example

```
ACTION: Admin Changes Subscription

DATABASE ENTRY (audit_logs):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ audit_logs                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                                  â”‚
â”‚ 550e8400-e29b-41d4-a716-446655440000â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ actor_id                            â”‚
â”‚ admin-uuid-12345                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ action                              â”‚
â”‚ 'updated_subscription'              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ target                              â”‚
â”‚ john@example.com                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ metadata                            â”‚
â”‚ {                                   â”‚
â”‚   "old_plan": "trial",              â”‚
â”‚   "new_plan": "premium",            â”‚
â”‚   "old_status": "trial",            â”‚
â”‚   "new_status": "active"            â”‚
â”‚ }                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ created_at                          â”‚
â”‚ 2024-02-04 10:30:45.123456         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADMIN CAN VIEW IN:
1. AdminScreenNew â†’ Audit Logs Tab
2. Supabase Dashboard â†’ audit_logs table
```

## Component Hierarchy

```
App
â”œâ”€â”€ main()
â”‚   â”œâ”€â”€ Supabase.initialize()
â”‚   â””â”€â”€ MyApp
â”‚       â”œâ”€â”€ kIsWeb check
â”‚       â”‚   â”œâ”€â”€ true â†’ AdminScreenNew (web)
â”‚       â”‚   â””â”€â”€ false â†’ AuthCheckScreen (mobile)
â”‚       â”‚       â”œâ”€â”€ Admin role â†’ AdminScreenNew
â”‚       â”‚       â””â”€â”€ User role â†’ HomeScreen
â”‚       â”‚           â””â”€â”€ Premium tab
â”‚       â”‚               â””â”€â”€ UserSubscriptionPage
â”‚       â””â”€â”€ Settings
â”‚           â”œâ”€â”€ theme
â”‚           â”œâ”€â”€ routes
â”‚           â””â”€â”€ home

AdminScreenNew (StatefulWidget)
â”œâ”€â”€ _AdminScreenNewState
â”‚   â”œâ”€â”€ initState()
â”‚   â”‚   â””â”€â”€ _setupRealtimeListeners()
â”‚   â”‚       â”œâ”€â”€ _accountsChannel
â”‚   â”‚       â””â”€â”€ _subscriptionsChannel
â”‚   â”œâ”€â”€ dispose()
â”‚   â”œâ”€â”€ build()
â”‚   â”‚   â”œâ”€â”€ kIsWeb check
â”‚   â”‚   â”‚   â”œâ”€â”€ true â†’ _buildWebAdmin()
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _buildWebSidebar()
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _buildWebTopBar()
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ _buildCurrentSection()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ _buildDashboard()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ _buildAccountsSection()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ _buildSubscriptionsSection()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ _buildProfitsSection()
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ _buildAuditLogsSection()
â”‚   â”‚   â”‚   â””â”€â”€ false â†’ _buildMobileAdmin()
â”‚   â”‚   â”‚       â””â”€â”€ Scaffold with BottomNavigationBar
â”‚   â”œâ”€â”€ _showEditAccountDialog()
â”‚   â”œâ”€â”€ _showEditSubscriptionDialog()
â”‚   â”œâ”€â”€ _showLogoutDialog()
â”‚   â””â”€â”€ _buildKpiCard()

UserSubscriptionPage (StatefulWidget)
â”œâ”€â”€ _UserSubscriptionPageState
â”‚   â”œâ”€â”€ initState()
â”‚   â”‚   â””â”€â”€ _setupRealtimeListener()
â”‚   â”œâ”€â”€ dispose()
â”‚   â”œâ”€â”€ build()
â”‚   â”‚   â””â”€â”€ FutureBuilder
â”‚   â”‚       â””â”€â”€ ListView.builder
â”‚   â”‚           â”œâ”€â”€ Subscription cards
â”‚   â”‚           â””â”€â”€ Manage buttons
â”‚   â”œâ”€â”€ _buildSubscriptionDetail()
â”‚   â”œâ”€â”€ _showManageDialog()
â”‚   â””â”€â”€ _showCancelConfirmation()
```

## User Roles & Permissions Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature             â”‚ Admin User       â”‚ Regular User       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ View Accounts       â”‚ âœ… All users     â”‚ âŒ Own only        â”‚
â”‚ Edit Account Name   â”‚ âœ… Any user      â”‚ âŒ No              â”‚
â”‚ Change User Role    â”‚ âœ… Any user      â”‚ âŒ No              â”‚
â”‚ View Subscriptions  â”‚ âœ… All users     â”‚ âœ… Own only        â”‚
â”‚ Edit Subscription   â”‚ âœ… Any user      â”‚ âŒ No              â”‚
â”‚ View Audit Logs     â”‚ âœ… All actions   â”‚ âŒ No              â”‚
â”‚ Real-time Updates   â”‚ âœ… All data      â”‚ âœ… Own data only   â”‚
â”‚ Manage Own Subs     â”‚ âŒ No            â”‚ âœ… Yes             â”‚
â”‚ Admin Dashboard     â”‚ âœ… Yes           â”‚ âŒ No              â”‚
â”‚ View KPI Cards      â”‚ âœ… Yes           â”‚ âŒ No              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IMPLEMENTATION:
- Role checked in Supabase Auth JWT token
- RLS (Row-Level Security) enforces database level
- Frontend checks for UX (backend enforces security)
```

## Error Handling Flow

```
User Action
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Try-Catch Block     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼
Success    Error
    â”‚         â”‚
    â–¼         â–¼
UI Update  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Error Handlerâ”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â–¼               â–¼
    â”‚   Log to     Show Error Dialog
    â”‚   console      to User
    â”‚      â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ UI State     â”‚
    â”‚ Remains      â”‚
    â”‚ Unchanged    â”‚
    â”‚ (User can    â”‚
    â”‚  retry)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

These diagrams show:
- System architecture and how components connect
- Data flow when admin makes changes
- Real-time sync between admin and user
- How audit logs are created
- Component hierarchy and widget tree
- User permissions and access control
- Error handling flow

All diagrams represent the actual implementation in the code.
